# 무선 이동 네트워크(Wireless and Mobile Networks)

이동/무선 네트워크에서 발생하는 문제들과 그 해결책은 유선 네트워크에서의 양상과는 상당히 다름
- 특히 데이터 링크, 네트워크 계층

> 이동 사용자, 무선 랜, 네트워크, 이들이 접속하는 더 큰 네트워크(보통 유선 네트워크)와의 관계
> 무선 통신 링크의 특성으로 인해 발생하는 문제와 무선 랜 덕분에 가능해진 이동성으로 인해 발생하는 문제 구분

1. 이동 무선 사용자가 네트워크 기반구조에 연결하는 네트워크 환경
2. 무선 랜의 특징
	1. CDMA
3. IEEE 802.11(WiFi) 무선 랜 표준
	1. 특히 링크 수준에서
4. 블루투스 및 기타 무선 개인 근거리 통신망(WPAN)
5. 음성과 고속 인터넷 접속이 모두 가능한 3G 및 4G 기술을 포함하는 셀룰러 인터넷 접근 기술
6. 이동성(이동 사용자 위치 파악, 데이터 경로 설정 문제, 핸드 오프)
7. 이동성 서비스가 802.11, LTE 네트워크의 이동 IP 표준에서 어떻게 구현되어 있는지
8. 무선 랜과 이동성이 트랜스포트 계층 프로토콜과 네트워크 응용에 미치는 영향

---

무선 랜, 셀룰러 네트워크 모두 포함하는 일반적인 논의

무선 네트워크 구성 요소
- 무선 호스트
- 무선 랜(wireless links)
	- 호스트는 무선 통신 링크를 통해 기지국이나 다른 무선 호스트에 연결
	- 여러 무선 랜 기술들은 전송 속도와 거리(영역), 비트 오류율과 그 원인에서 차이
	- 네트워크 내부에서도 사용될 수 있음
		- 라우터, 스위치 등 다른 네트워크 장치들 사이를 연결
- 기지국
	- 무선 네트워크 기반구조의 핵심
	- 호스트, 랜과 달리 대응되는 요소가 유선 네트워크에 없음
	- 기지국에 결합(association)된 무선 호스트와의 데이터 송수신 책임
- 네트워크 기반구조: 무선 호스트가 통신하고자 하는 큰 네트워크
> 결합
> - 호스트가 해당 기지국의 영역 안에 있음
> - 호스트가 자신과 네트워크 간 데이터 중계(relay)를 위해 해당 기지국 사용
> - 셀룰러 네트워크에서 셀 타워, 802.11 무선 네트워크에서의 AP
> - 무선 호스트와 다른 네트워크 부분과의 링크 계층 중계 기능 제공


무선 네트워크의 분류(2가지 기준)
1. 무선 네트워크 내의 패킷이 하나의 홉만을 거치는가 또는 여러 홉을 거치는가
2. 기지국과 같은 네트워크 기반구조가 있는가

단일 홉, 기반구조 존재
- 통신이 기지국과 무선 호스트 간 단일 무선 홉으로 이루어짐
- 802.11, 4G 등

단일 홉, 기반구조 없음
- 단일 홉 네트워크 안의 하나의 노드가 다른 노드들의 전송을 중재, 조정
- Bluetooth, ad hoc 형태의 802.11

---

무선 랜과 네트워크의 특징

호스트를 서로 연결하는 유선 이더넷 스위치가 있는 단순한 유선 네트워크에서 유선 이더넷을 무선 802.11 네트워크로 대체하면, 무선 네트워크 인터페이스는 호스트의 유선 이더넷 인터페이스를 대체, 무선 AP는 이더넷 스위치를 대체
(네트워크 계층 이상의 계층은 변경 불필요)

유선, 무선 네트워크의 중요한 차이점은 링크 계층에만 집중적

특징
- 신호 세기의 감소(decreasing signal strength)
	- 전파는 물체를 통과함에 따라 약화
	- 자유 공간에서도 신호 분산
	- 송/수신자 간 거리 증가에 따라 신호의 세기가 감소
       -> 경로 손실(path loss)
- 다른 출발지로부터의 간섭
	- 동일 주파수 대역으로 전송되는 무선 신호들은 서로 간섭
- 다중경로 전파
	- 송수신자 간 전송되는 전파의 일부가 물체에 부딪혀 서로 길이가 다른 여러 경로를 거쳐갈 때 다중경로 전파 현상
	- 다중경로 전파는 수신 측에서 감지되는 신호를 또렷하지 않게 만듬

이런 이유로 유선 링크보다 무선 랜에서 비트 오류가 더 잘 생길 수 있음
그래서 무선 랜 프로토콜은 강력한 CRC 오류 검출 코드를 사용, 링크 수준의 신뢰성 있는 데이터 전송 프로토콜 사용(손상된 프레임 재전송)

차이
- 비트 오류 발생률
- (다중 접속)숨은 터미널 문제, 페이딩 현상

---

CDMA(Code Division Multiple Access)
- 공유 매체 접속 프로토콜
	- 공유 매체를 통해 호스트들이 통신할 때, 여러 송신자에 의해 전송된 신호가 수신측에서 간섭되지 않게 해줌
- 무선 랜 및 셀룰러 기술에서 많이 사용

방식
- 송신자가 전송하는 각 비트를 확장해 원래 데이터 비트열보다 훨씬 빠른 속도(chipping rate)로 변하는 신호(code)를 곱하는 방식으로 인코딩
- 원래 데이터 비트들이 CDMA 인코더에 도착하는 속도에 의해 시간의 단위가 정의
	- 즉, 전송되는 각 원래 데이터 비트는 하나의 비트 슬롯 시간이 필요
- d_i: i번째 비트 슬롯의 데이터 비트값
- 편의상 0값을 갖는 데이터 비트는 -1로 표시
- 각 비트 슬롯은 M개의 미니 슬롯들로 더 분할
- 송신자가 사용하는 CDMA 코드는 일련의 연속된 M개의 값 c_m으로 구성(각 값은 +1 또는 -1값)

d_i의 비트-전송 시간의 m번째 미니 슬롯에 대한 CDMA 인코더의 출력 Z_i,m은 할당된 CDMA 코드의 m번째 비트인 c_m을 d_i에 곱한 값
Z_i,m = d_i \* c_m
![[Screenshot 2023-05-29 at 7.25.41 PM.png]]
간섭하는 다른 송신자가 없다고 가정

간섭하는 다른 송신자들이 전송한 비트들과 섞여 있는 송신자의 원래 데이터 비트를 어떻게 다시 생성?

가정: 동시에 전송된 비트 신호들을 더할 수 있다
(같은 미니 슬롯에서 세 명의 송신자가 1 값을 전송하고 네 번째 송신자가 -1의 값을 전송하면 그 미니 슬롯에서 모든 수신자가 수신하는 신호는 2)

다수의 송신자가 있는 경우에도 송신자 s는 자신의 인코딩된 전송인 Z^s_i,m 계산

그러나 i번째 비트 슬롯의 m번째 미니 슬롯은 그 미니 슬롯 동안 모든 N 송신자가 전송한 비트들의 합

> 송신자의 코드를 주의 깊게 선택한다면 수신자는 특정 송신자 코드를 사용해 다수 송신자로부터의 합쳐진 신호로부터 원하는 송신자가 전송한 데이터 추출 가능

![[Screenshot 2023-05-29 at 7.33.08 PM.png]]

> 각 노드에게 적당한 코드 공간을 할당하는 분할 프로토콜

필수적인 설명일 뿐 더 어려운 문제들이 있음
1. CDMA 코드를 주의 깊게 선택해야함
2. 앞에서는 여러 송신자로부터의 신호 세기가 수신자 쪽에서 동일하다고 가정했으나 이런 경우는 드뭄

---

WiFi: 802.11 무선 랜

1990년대에 다양한 무선 랜 관련 기술 및 표준이 개발되었으나 그 중 가장 성공적인 하나의 기술이 승자로서 모든 기술들을 통합했음 - WiFi로 알려진 IEEE 802.11 무선 랜

> - 802.11 프레임 구조
> - 802.11 매체 접속 프로토콜
> - 802.11 랜과 유선 이더넷 랜의 연동

아래와 같이 IEEE 802.11에는 여러 표준안 존재
공통적 특징
- CSMA/CA라는 동일한 매체 접속 프로토콜
- 동일한 링크 계층 프레임 구조
- 전송 거리를 증가시키기 위해 전송률을 감소시키는 기능
- (중요) 이전 표준 기술과의 호환성
	- e.g. 802.11g 기능만을 갖는 모바일 기기도 802.11ac 기지국과 상호작용 가능
![[Screenshot 2023-05-29 at 7.41.40 PM.png]]

물리 계층에서 차이
- 802.11 무선랜 기기들은 두 종류의 서로 다른 주파수 영역에서 동작(2.4GHz, 5GHz)
	- 전자는 비허가(unlicensed) 주파수 대역
		- 이 영역에서 802.11 기기들은 2.4 GHz 무선 전화 및 주파수 대역을 사용하는 전자레인지와 경쟁
	- 5 GHz 대역의 802.11 랜은 전력 수준이 동일할 경우 전송 거리가 더 짧고 다중경로 전파의 영향을 더 많이 받음


가장 최신의 2가지 WiFi 표준인 802.11n, 802.11ac는 MIMO를 사용
- 송신, 수신 측에 각각 2개 이상의 안테나가 있어 서로 다른 신호를 송수신

802.11ac 기지국은 여러 스테이션에 동시 전송 가능, 목적지에 따라 동적으로 수신자의 방향을 향해 전송할 수 있는 스마트 안테나 사용
- 간섭을 줄이고, 동일한 데이터 전송률에서의 도달 거리를 향상시키는 기능

---

802.11 구조

기본 구성 단위: BSS(Basic Service Set)

BSS는 하나 이상의 무선 스테이션과 하나의 중앙 기지국(802.11 용어로 AP)로 구성

두 BSS의 각 AP가 인터넷에 연결된 장치(스위치, 라우터 등)에 연결되는 모습
일반 홈 네트워크에서는 BSS를 인터넷으로 연결하는 하나의 AP와 하나의 라우터(대개 하나의 제품으로 통합 구현)가 필요

이더넷 장치처럼 802.11 무선 기지국은 6 바이트의 MAC 주소를 가짐
MAC 주소는 스테이션의 어댑터(802.11 NIC) 펌웨어에 저장
각 AP도 자신의 NIC에 대한 MAC 주소 가짐

AP를 가진 무선 랜을 인프라스트럭처 무선 랜(infrastructure wireless LAN)이라 함

인프라스트럭처는 AP와 라우터를 연결해주는 유선 이더넷 기반구조와 AP를 통칭

---

채널과 결합

802.11에서 무선 단말기는 네트워크 계층 데이터를 포함하는 802.11 프레임을 송수신하기 전에 AP와 결합되어 있어야함

AP를 설치할 때 
- AP에게 하나 혹은 두 워드의 SSID(Service Set Identifier)를 할당
- AP에게 채널 번호 할당
	- 802.11이 2.4 ~ 2.485 GHz 주파수 범위에서 동작하는 것과 관련
	- 802.11은 주파수 범위의 85 MHz 대역에서 11개의 일부 겹치는 채널 정의
	- 두 개의 채널은 4개 이상의 채널에 의해 분리되어 있어야만 겹치지 않음
	- 특히 1, 6, 11이 유일하게 겹치지 않는 3개의 채널
	- 즉, 고나리자는 3개의 802.11b AP를 같은 장소에 설치하고 각각 1, 6, 11 채널을 할당하고 스위치를 연결함으로써 33 Mbps의 최대 전송률을 갖는 무선 랜 생성 가능

WiFi 정글
- 무선 스테이션이 둘 이상의 AP로부터 충분히 강한 신호를 받을 수 있는 모든 지역

무선 스테이션이 어떻게 특정 AP와만 결합될 수 있나?
정글 안에 어떤 AP들이 있는 지 무선 스테이션이 어떻게 알 수 있나?
- 802.11 표준은 AP가 주기적으로 비컨 프레임(beacon frame)을 전송할 것을 요구
	- 프레임 안에는 AP의 SSID와 MAC 주소 포함
- 무선 스테이션은 주변 AP로부터 비컨 프레임을 찾기 위해 11개 채널을 살펴봄(일부 AP들은 동일 채널로 보낼 수도 있음)
- 비컨 프레임으로부터 사용 가능한 AP들의 정보를 얻은 무선 스테이션은 결합을 맺을 AP 선택

802.11 표준은 가용한 AP 중 어떤 것을 선택할 지를 정하는 알고리즘 정의하고 있지 않음
(무선 호스트의 펌웨어 혹은 소프트웨어 설계자가 결정)

일반적으로 비컨 시그널의 세기가 가장 강한 AP 선택하지만 이것이 무선 호스트의 수신 성능을 결정하는 유일한 특성은 아님

특히, 다른 호스트와 중복 선택이 되어 대역폭을 공유해야하는 경우 발생 가능

신호의 세기를 어떻게 측정하는가
-> [Bardwell 2004]

수동적 스캐닝(passive scanning)
- 비컨 프레임의 수신을 통해 채널을 찾는 과정

능동적 스캐닝(active scanning)
- 무선 호스트가 영역 내에 있는 AP들에게 탐사용 프로브 프레임을 방송하는 방식
- AP들이 프로브 요청에 대해 프로브 응답 메시지를 보내오면 무선 호스트들은 이 AP 중 하나 선택 가능

![[Screenshot 2023-05-29 at 8.10.20 PM.png]]

AP 선택 후, 무선 호스트는 선택된 AP에게 결합 요청 메시지 전송하고 AP는 결합 수락 메시지 반송
(능동적 스캐닝 시 필요)

AP와의 결합 단계가 끝난 후, 무선 호스트는 AP가 속한 서브넷에 가입하고 싶어할 것. 무선 호스트는 AP의 서브넷 IP 주소를 얻기 위해 결합된 AP를 통해, 서브넷으로 "DHCP 발견 메시지" 전송.
서브넷 주소를 얻으면 인터넷의 나머지 노드는 이 무선 호스트를, 선택된 AP의 서브넷 내부의 IP 주소를 지닌 한 호스트로 여김

무선 스테이션이 특정 AP와 결합하기 위해서는 해당 AP에게 자신을 인증시켜야 할 때도 있음

802.11 무선 랜에서는 다수의 인증 및 접근 방법 제공
- 그 중 한 방법은, 스테이션의 MAC 주소를 기반으로 무선 네트워크로의 접근을 허용하는 것으로, 많은 회사에서 사용
- 다른 방법은, 인터넷 카페에서 사용하는 것으로, 사용자 이름과 암호 사용
두 방법 모두 AP는 인증 서버와 통신하며, 무선 종단 스테이션과 인증 서버는 RADIUS나 DIAMETER 같은 프로토콜을 사용해 정보 중계
- 인증 서버와 AP를 분리함으로써 하나의 인증 서버가 여러 AP 지원 가능
- 민감한 인증 및 접근 결정을 단일 서버에서 중앙집중식으로 가능
- AP 비용과 복잡성 낮춤
802.11i에서 이 방법 사용

---

802.11 MAC 프로토콜

여러 스테이션이 동시에 동일 채널로 데이터 프레임을 전송할 수 있으므로 다중 접속 프로토콜 필요
채널 분할(Ex. CDMA), 랜덤 접속, 순번제 등이 있는데, 랜덤 접속 프로토콜 사용

CSMA/CA(carrier sense multiple access with collision avoidance)
- 즉, 스테이션이 전송하기 전에 채널 상태를 감지하고, 만일 채널이 사용 중이면 전송하지 않음
- 이더넷과 마찬가지지만 MAC 프로토콜에는 중요한 차이
	1. 802.11은 충돌 검출(collision detection)을 하지 않고 충돌 회피를 사용
	2. 무선 채널의 비트 오류율이 상대적으로 더 크므로, 이더넷과 다르게 링크 계층 ARQ(ACK/재전송) 방식 사용

802.11의 충돌 회피와 링크 계층 ACK 방식

- 이더넷 스테이션은 전송하면서 동시에 채널을 감지
- 전송 도중에 또 다른 기지국이 동시에 전송하는 것을 감지하면 스테이션은 전송을 중단하고 임의 시간만큼 기다린 후 다시 전송
- 802.3 이더넷 프로토콜과 달리 802.11 MAC 프로토콜은 아래 이유 때문에 충돌 검출을 구현하고 있지 않음
	1. 충돌 검출을 하려면 스테이션 자신의 신호 송신과 다른 스테이션의 전송 여부 결정을 위한 수신이 동시에 가능해야함. 일반적으로 802.11 어댑터에서 수신 신호의 세기는 송신 신호의 세기에 비해 매우 약하므로, 송수신을 모두 고려해 충돌을 검출할 수 있는 하드웨어를 만드는 데 많은 비용
	2. 더 중요한 이유, 동시에 송수신이 가능하고 다른 스테이션에 의한 채널 사용을 감지했을 때 전송을 중단할 수 있다고 하더라도, 숨은 터미널 문제와 페이딩 때문에 802.11 어댑터는 충돌을 검출하지 못할 수도 있음


- 802.11 무선 랜은 충돌 검출을 사용하지 않으므로, 일단 스테이션이 프레임을 전송하기 시작하면 그 프레임을 모두 전송
- 충돌이 빈번할 때, 프레임(특히 큰 프레임) 전체를 전송하면 다중 접속 프로토콜의 성능이 상당히 저하될 수 있음
- 충돌 가능성을 감소시키기 위해 몇 가지 충돌 회피 기술을 사용

충돌 회피를 다루기 전에 802.11의 링크 계층 ACK 방법
- 전송한 프레임은 여러 이유로 목적지 스테이션에 제대로 도달하지 못할 수 있음
- 이를 해결하기 위해 802.11 MAC에서는 링크 계층 ACK 사용

링크 계층 ACK
- 목적지 기지국은 CRC 검사를 통과한 프레임을 수신하면 SIFS(Short Inter Frame Spacing)라는 짧은 시간을 기다린 후에 ACK 프레임을 송신자에게 보냄
- 만약 송신 기지국이 주어진 시간 동안에 ACK를 수신하지 못하면, 송신 스테이션은 오류가 발생했다고 가정하고 다시 CSMA/CA 프로토콜을 사용해서 채널 접근을 한 후 프레임 재전송
- 일정 횟수 만큼의 재전송 후에도 ACK를 수신하지 못하면 송신 스테이션은 포기하고 프레임 폐기

802.11 CSMA/CA 프로토콜
> 가정: 스테이션(무선 기기나 AP)이 전송할 프레임을 갖고 있다고 가정

1. 스테이션은 채널이 사용되지 않음을 감지하면 DIFS(Distributed Inter Frame Space)라는 짧은 시간 동안 기다린 후 프레임 전송
2. 만약 채널이 사용 중이면, 스테이션은 백오프 방식에 따라 선택된 임의 시간 대기. DIFS 시간 이후 채널이 사요되지 않음을 감지하면 선택된 시간의 카운터 값은 감소, 감지되면 그대로 유지
3. 카운터가 0에 도달하면(이것은 채널이 사용되지 않을 때만 가능), 스테이션은 프레임 전체를 전송한 후에 ACK를 기다림
4. ACK를 수신하면, 송신 스테이션은 프레임이 목적지 스테이션에 의해 제대로 수신되었다는 것을 알게 됨. 만일 전송할 프레임이 더 있다면, 단계 2의 CSMA/CA 프로토콜 수행. ACK를 수신하지 못하면 더 증가된 임의 시간 값을 선택한 후 단계 2의 백오프 과정 수행

![[Screenshot 2023-06-01 at 8.17.09 PM.png]]

- 이더넷의 CSMA/CD 다중 접속 프로토콜에서는 채널이 사용되지 않는 상태임을 감지한 스테이션은 바로 전송 시작
- 그러나 CSMA/CA 프로토콜에서는 유휴 상태 감지해도 임의 백오프 값을 선택해 카운트다운 과정을 거치므로 전송을 지연 시킴

이유는?
- 상황: 각각 전송할 프레임을 가진 두 개의 스테이션이 또 다른 제 3의 스테이션이 이미 전송하고 있음을 감지했기 때문에 바로 전송하지 않음
- 이더넷 CSMA/CD에서는 전송 중이었던 스테이션이 전송을 마치면 이 두 스테이션이 바로 전송 시작
- 이 경우 충돌이 발생, CSMA/CD에서는 두 스테이션 모두 전송을 즉시 중단. 따라서 충돌을 겪은 프레임의 나머지 부분을 전송하지 않음으로써 불필요한 전송을 피해 문제가 심각해지지 않음
- 그러나 802.11에서는 충돌 검출도 하지 않고 전송을 중단하지도 않으므로, 충돌을 겪은 프레임이라도 전체를 다 전송
- 따라서 802.11의 목표는 가능한 충돌을 피하는 것
- 802.11의 경우, 두 스테이션이, 채널이 현재 사용 중인 것을 감지하면 이들은 서로 다른 백오프 시간이 선택되기를 기대하며 임의의 백오프(Random Backoff) 기법 수행
- 선택된 백오프 시간이 달라 채널이 사용되지 않는 상태에 도달했을 때 두 스테이션 중 하나가 다른 스테이션보다 먼저 전송을 시작하며, (만일 두 스테이션이 모두 서로로부터 숨은 터미널이 아니라면) 경쟁에 진 스테이션은 경쟁에 이긴 스테이션의 신호를 감지하고 자신의 카운터를 멈춘 후 경쟁에 이긴 스테이션이 전송을 완료할 때까지 기다림
- 이런 방식으로 충돌 회피

> 물론 이 상황에서도 두 스테이션이 서로 숨은 터미널이거나 서로 선택한 임의 백오프 값이 너무 가까운 경우 충돌 발생 가능


##### 숨은 터미널 해결 방안: RTS와 CTS
- 802.11 MAC 프로토콜은 숨은 터미널이 존재해도 충돌 회피 가능한 훌륭한 예약 방법을 선택할 수 있도록 제공

상황
- 2개의 무선 스테이션과 하나의 AP가 있음
- 두 무선 스테이션들은 동일한 AP 영역(원) 내에 있으며 이 AP와 결합되어 있음
- 하지만 페이딩 때문에 무선 스테이션의 신호 범위는 어두운 원으로 제한됨
- 따라서 각 무선 스테이션은 AP로부터는 잘 보이지만 그들 서로 간에는 숨어있음

![[Screenshot 2023-06-01 at 8.37.14 PM.png]]


숨은 터미널이 왜 문제인지?
- 가정: 스테이션 H1이 프레임을 AP로 전송하고 있고, H1이 전송하는 도중에 스테이션 H2가 AP로의 전송을 원함
- H1의 전송을 듣지 못한 H2는 임의 시간(DIFS)를 기다린 후 DATA 프레임을 전송하며 이 경우 충돌 발생
- 따라서 H1, H2의 전체 전송 시간동안 채널이 낭비됨
- 이를 해결하기 위해 802.11 프로토콜에서는 스테이션들이 짧은 RTS(Request to Send) 제어 프레임과 짧은 CTS(Clear to Send) 제어 프레임을 주고 받게 함으로써 채널 접근을 예약할 수 있게 함
- 송신자는 DATA 프레임을 전송하고 싶으면, 먼저 RTS 프레임을 AP에게 보냄으로써 DATA 프레임과 ACK 프레임을 전송하는데 필요한 전체 시간을 알려줌
- AP가 RTS를 수신하면 이에 대한 응답으로 CTS 프레임을 송신 스테이션을 포함한 영역 내 모든 스테이션들에게 전송
- CTS 프레임은 송신자에게는 전송할 수 있다는 허가를 명확하게 알려주고, 다른 스테이션들에게는 예약된 시간 동안 전송하지 못하게 하는 두 가지 목적을 수행함

![[Screenshot 2023-06-01 at 8.37.30 PM.png]]


RTS, CTS 프레임을 사용하면 두 가지 측면에서 성능 향상
- 숨은 스테이션 문제가 완화될 수 있음; 채널을 예약한 후에만 길이가 긴 DATA 프레임을 전송하기 때문
- RTS, CTS 프레임은 길이가 짧고, RTS/CTS 프레임에 의한 충돌은 이 짧은 프레임이 전송되는 동안에만 발생.
- 일단 이 프레임들이 제대로 전송되면 그 후의 DATA, ACK 프레임은 충돌없이 전송

> RTS, CTS를 교환함으로써 지연과 채널 자원의 낭비가 생김
> 따라서 RTS, CTS 교환은 긴 DATA 프레임을 전송하기 위해 채널을 예약할 때만 사용됨
> 무선 스테이션에서는 RTS 임계치를 설정할 수 있음
> 많은 무선 스테이션에서는 RTS 임계치값이 최대 프레임 길이보다 길게 설정되어 있어 RTS, CTS 절차가 생략됨

---

##### 점대점 링크로서의 802.11 사용
- 여태까지는 802.11을 다중 접속 상황에서 살펴봄
- 만일 두 노드가 지향성 안테나(directional)을 갖고 있다면, 안테나로 상대방을 가리킴으로써 지점 간의 링크를 형성하고 이 링크에 대해 802.11 프로토콜 실행 가능
- 비용이 저렴한 802.11 하드웨어에 지향성 안테나와 증가된 전송 전력을 사용해 수십 km 거리의 무선 지점 사이에 연결 제공하는 저렴한 수단으로 사용될 수 있음

---

#### IEEE 802.11 프레임

이더넷 프레임과 많은 유사성을 가지나 무선 랜에서의 특화된 몇 개의 필드를 가짐

숫자는 필드 길이를 바이트 단위로 나타낸 것
프레임 컨트롤 필드의 서브필드 위의 숫자는 서브필드 길이를 비트 단위로

![[Screenshot 2023-06-01 at 8.47.15 PM.png]]

##### 페이로드
- 하나의 IP 데이터그램이나 ARP 패킷으로 구성

##### CRC 필드
- 이더넷 프레임처럼 802.11 프레임은 수신자가 수신한 프레임의 비트 오류를 검출할 수 있도록 32비트의 CRC 포함

##### 주소 필드
- 가장 큰 차이점: 4개의 주소 필드를 가지고 있다는 것
	- 각 주소 필드는 6바이트의 MAC 주소를 포함할 수 있음
- 왜 4개나 필요?
	- 먼저 네트워크 연동(internetworking)을 위해 세 개의 주소 필요
	- 무선 스테이션에서 AP를 통해 라우터 인터페이스로 네트워크 계층 데이터그램을 전송하는 경우가 여기에 해당
	- 네번째 주소는 애드 혹 네트워크 모드에서 사용
- 기지국이 존재하는 인프라스트럭처 네트워크에 대해서만 살펴볼 것이므로, 첫 세 개의 주소 필드만 집중해서 설명함.

802.11 표준에서는 이 세 개의 주소 필드를 다음처럼 정의
- Address 2
	- 프레임을 전송하는 스테이션의 MAC 주소.
	- 무선 스테이션이면 무선 스테이션의 MAC 주소가, AP면 AP의 MAC 주소가 이 필드에 삽입됨
- Address 1
	- 프레임을 수신 하는 무선 스테이션의 MAC 주소
	- 따라서 이동 무선 스테이션이 전송 -> AP의 MAC
	- AP가 전송 -> 목적지 무선 스테이션의 MAC
- Address 3
	- BSS(AP와 무선 기지국들로 구성된 BSS)가 서브넷의 일부이고, 이 서브넷은 라우터 인터페이스를 통해 다른 서브넷으로 연결된다는 것을 알아야함
	- 이 라우터 인터페이스의 MAC 주소

![[Screenshot 2023-06-01 at 8.53.55 PM.png]]

Address 3의 쓰임에 대한 이해
- 그림) 각 AP는 라우터에 직접 연결, 라우터는 글로벌 인터넷에 연결. AP는 링크 계층 장치(즉, IP 기능을 갖기 않고 IP 주소 이해 못함)
- 상황: 라우터 인터페이스 R1으로부터 무선 스테이션 H1으로 데이터그램 전달
- 라우터는 자신과 H1 사이에 AP 존재 여부 모름 - 라우터는 H1을 자신에게 연결된 서브넷 중의 하나에 속한 호스트 정도로 생각
- 이더넷 랜에서와 같이, 데이터그램의 목적지 주소로부터 H1의 IP 주소를 알게된 라우터는 ARP를 사용해 H1의 MAC 주소를 결정. H1의 MAC 주소를 획득한 라우터 인터페이스 R1은 이더넷 프레임 내에 데이터그램을 캡슐화. 이 프레임의 출발지 주소 필드는 R1의 MAC 주소를 포함, 목적지 주소 필드는 H1의 MAC 주소를 포함
- 이더넷 프레임이 AP에 도착하면, AP는 이 프레임을 무선 채널로 전송하기 전에 802.3 이더넷 프레임을 802.11 프레임으로 변환. AP는 Address 1, Address 2를 H1의 MAC 주소, 자신의 MAC 주소로 채워넣음. AP는 Address 3에 R1의 MAC 주소를 포함. 이런 식으로 H1은 데이터그램을 서브넷으로 전송한 라우터 인터페이스의 MAC 주소를 Address 3으로부터 알 수 있음

무선 기지국 H1이 응답으로 R1에게 데이터그램을 전송하는 경우
- H1은 Addr 1, Addr 2에 각각 AP, H1의 MAC 주소, Addr 3에 R1의 MAC 주소 포함된 802.11 프레임 생성
- AP가 이 802.11 프레임을 수신하면, 이더넷 프레임으로 변환. 이더넷 프레임의 출발지 주소는 H1의 MAC 주소, 목적지 주소 필드는 R1의 MAC 주소가 됨. 따라서 Addr 3은 AP가 이더넷 프레임을 구성할 때 목적지 MAC 주소를 결정할 수 있게 해줌

> 정리: Address 3은 BSS를 유선 랜과 연동시키는 데 있어서 핵심적인 역할

#### Sequence Number, Duration, Frame Control 필드




---

셀룰러 인터넷 접근

> - 최신 셀룰러 인터넷 접근 기술
> - 여러 기지국 사이를 이동하고 있는 사용자에게 어떻게 연결(call)이 설정되는지

> 셀룰러 기술 자세한 설명
> [Goodman 1997; Kaaranen 2001; Lin 2001; Korhonen 2003; Schiller 2003; Palat 2009; Scourias 2012; Turner 2012; Akyildiz 2010]
> 특히 [Mouly 1992; Sauter 2014]는 전 방면에 걸친 뛰어난 참고 내용

---

셀룰러 네트워크 구조 개요

GSM(Global System for Mobile Communications)
- 1980년대에 유럽에서 상호 호환이 되지 않는 다수의 기존 아날로그 전화 시스템을 대체하고 유럽을 포괄하는 디지털 시스템으로서 셀룰서 통신을 위해 만든 표준
- 1990년대 초에 GSM 기술 실현, 이후 세계 셀룰러 사용자의 약 80%가 사용

---

2G 셀룰러 네트워크 구조: 전화망으로의 음성 연결

> 셀룰러: 지리 영역이 여러 개의 유효 도달 범위, 즉 셀로 나뉜 것을 의미

한 셀에는 하나의 기지국(Base Transceiver Station, BTS)이 존재
- 해당 셀 내의 이동 스테이션의 신호 송수신
- 도달 범위는 송신 전력, 셀 내부의 방해 건물, 기지국 안테나 높이 등 여러 요인

GSM 표준
- 무선 인터페이스를 위해 FDM/TDM이 혼합된 방식 사용
- FDM
	- 채널을 여러 개의 주파수 대역으로 나누고 각 주파수 대역마다 하나의 콜을 할당
- TDM
	- 시간을 프레임 단위로 분할 후 다시 프레임을 슬롯 단위로 나눈 후 각 콜을 각 프레임의 특정 슬롯에 할당
- 혼합 시스템
	- 채널을 다수의 주파수 부대역(sub-band)들로 나눈 후 각 부대역에서 시간을 프레임과 슬롯으로 분할
	- 따라서 하나의 채널을 F개 부대역으로 나누고 시간을 T개 슬롯으로 나누면 FxT개의 콜을 동시 지원 가능
- 200 KHz 주파수 대역 사용
	- 각 주파수 대역은 8개의 TDM 콜 지원
- 음성을 13 kbps와 12.2 kbps로 인코딩
- 기지국 제어기(Base Station Controller, BSC)는 보통 수십 개 기지국에 대한 서비스 지원
	- 무선 채널을 이동 사용자에게 할당하고 페이징(이동 사용자가 현재 위치한 셀의 위치를 찾아내는 것), 핸드오프 기능 수행
- 기지국 제어기와 그 제어를 받는 기지국들은 하나의 GSM 기지국 시스템(BSS)을 구성
- 이동 교환 센터(Mobile Switching Center, MSC)
	- 이동 단말기의 셀룰러 네트워크 접근을 허가하는 사용자 인증, 과금(accounting), 사용자 콜의 설정과 해제, 핸드오프 등
	- 보통 하나의 MSC는 5개까지의 BSC 포함
		- 대략 20만의 가입자에 해당
	- 셀룰러 사입자는 많은 수의 MSC 운영
	- 여기에는 게이트웨이 MSC도 포함
		- 사업자의 셀룰러 네트워크를 더 큰 전화 네트워크와 연결하는 특수한 기능

![[Screenshot 2023-05-29 at 8.47.02 PM.png]]


---

3G 셀룰러 데이터 네트워크: 무선 가입자로의 인터넷 확대

전자메일, 웹 접속, 지도 서비스 등을 위해서는 스마트폰이 물리 계층부터 응용 계층까지의 전체 TCP/IP 프로토콜 스택을 실행해야 함
셀룰러 데이터 네트워크를 통해 인터넷과 접속할 수 있어야함

3GPP에서 개발한 3G/4G UMTS(Universal Mobile Telecommunications Service) 3G 표준안에 집중

---

![[Screenshot 2023-05-29 at 8.57.51 PM.png]]

3G 코어 네트워크
- 무선 액세스 네트워크를 공중 인터넷에 연결
- 셀룰러 음성 네트워크 요소들, 특히 MSC 들과 협력 작업
- 기존의 GSM 기반 셀룰러 음성 네트워크의 기본은 그대로 두고 거기에 병행하는 추가적인 셀룰러 데이터 기능을 추가하는 방식을 취함
- 두 가지 종류의 노드
	- SGSN(Serving GPRS Support Node)
		- 해당 SGSN이 접속해 있는 무선 액세스 네트워크에서 이동 단말기 간의 데이터그램 송수신 책임
		- 셀룰러 음성 네트워크의 MSC와 협력 작업을 하며 사용자 인증, 핸드오프, 이동 단말기의 위치 및 셀 정보 관리, 무선 액세스 네트워크와 GGSN 사이의 데이터그램 전달 담당
	- GGSN(Gateway GPRS Support Node)
		- 마치 게이트웨이와 같이 동작, 다수의 SSGN들을 더 큰 인터넷과 연결
		- 따라서 GGSN은 이동 단말기로부터 전송된 데이터그램이 더 큰 인터넷에 진입하기 직전에 만나는, 3G 인프라스트럭처의 마지막 단계
		- 외부의 인터넷에서 보기에는 GGSN은 일반적인 게이트처럼 보임
			- 즉, GGSN 안쪽 네트워크의 3G 노드의 이동성은 외부의 인터넷 세계에는 감추어져 있음

> GPRS(Generalized Packet Radio Service)
> - 2G 네트워크에서의 초기 셀룰러 데이터 서비스

---

3G 액세스 네트워크
- 3G 사용자가 만나는 무선 첫번째 홉 네트워크
- 무선 네트워크 제어기(Radio Network Controller, RNC)
	- 보통 여러 개의 BTS를 제어
	- 2G 시스템에서의 기지국과 유사하나 3G UMTS 용어로는 Node-B로 불림
	- 각 셀에서 무선 랜은 2G와 마찬가지로 BTS와 무선 단말기 사이에서 동작
	- RNC는 회선교환 방식의 셀룰러 음성 네트워크와는 MSC를 통해서, 패킷 교환 방식의 인터넷과는 SGSN을 통해서 양 쪽 다 연결되어 있음
	- 따라서 3G 셀룰러 음성과 데이터는 서로 다른 기본 네트워크를 사용하지만 공통의 첫번째 홉 또는 마지막 홉이 되는 무선 액세스 네트워크를 공유
- 2G 네트워크와 비교하여 큰 변화는 GSM의 FDMA/TDMA 혼합 방식이 아닌 DS-WCDMA(Direct Sequence Wideband CDMA)라고 불리는 기술을 사용
- TDMA 슬롯 안에서 이 새로운 CDMA 기술 사용
- TDMA 슬롯은 다시 여러 개의 주파수 영역에서 사용 가능
- 이러한 변화는 새로운 3G 셀룰러 무선 액세스 네트워크가 2G 무선 BSS 네트워크와 병행하여 동작할 것을 요구
- WCDMA 기술 사양과 관련한 데이터 서비스는 HSPA(High Speed Packet Access)로 알려졌으며 14Mbps의 다운 링크 속도 보장

> 3G 네트워크 관련 자세한 내용은 [3GPP 2016]

---

4세대로: LTE

![[Screenshot 2023-05-29 at 9.14.53 PM.png]]

2가지 중요한 요소
- 통일된 all-IP 네트워크 구조
	- 음성과 데이터 통로가 별도로 존재하는 3G 네트워크와 달리, 음성과 데이터 모두 IP 데이터그램에 의해 사용자 장비(UE)인 무선 기기로부터 패킷 게이트웨이(P-GW)로 전송
	- 4G에 이르러 음성전화에 기반한 기존 셀룰러 네트워크의 잔재가 완전히 사라지고 보편적인 IP 서비스로의 전환
- 4G 데이터 플레인과 제어 플레인의 명확한 분리
	- IP 계층의 데이터와 제어의 구분 반영
- 무선 액세스 네트워크와 all-IP 코어 네트워크(EPC)의 명확한 분리
	- 사용자 데이터를 운반하는 IP 데이터그램은 UE로부터 P-GW를 거쳐 4G 내부 네트워크 및 외부 네트워크로 전달
	- 제어 패킷은 역시 같은 네트워크 상의 4G 제어 서비스 요소들을 통해 교환

4G 구조의 핵심적인 요소
- eNodeB
	- 2G 기지국과 3G의 node B가 진화한 형태 - 마찬가지로 중심적 기능 수행
	- 데이터 플레인 측면에서는 LTE 무선 액세스 네트워크를 통해 UE와 P-GW 간 데이터그램 전달
	- UE 데이터그램은 캡슐화되어 eNodeB와 P-GW 간에 4G all-IP 네트워크를 통해 <mark style="background: #FF5582A6;">터널링</mark> 됨
		- IPv6에서 보았던 IPv4 라우터들을 통과하는 두 개의 IPv6 종점 사이의 터널링과 유사
		- 이 터널링은 QoS 보장과 연관
		- Ex. 4G 네트워크는 UE와 P-GW 간 음성 전송이 100msec 이하의 지연과 1% 이하의 패킷손실률을, TCP 트래픽은 300msec 이하의 지연과 0.0001% 미만의 패킷 손실률을 갖도록 보장 가능
		- <mark style="background: #FF5582A6;">QoS 문제는 9장 참고</mark>
	- 제어 플레인 측면에서는 eNodeB가 UE의 도움을 받아 등록과 이동성 신호 정보를 관리
- 패킷 데이터 네트워크 게이트웨이(P-GW)
	- UE에게 IP 주소 할당, QoS 관리
	- UE와의 터널링의 종점으로서 데이터그램 전달 시에 데이터 캡슐화 및 캡슐 제거를 담당
- S-GW
	- 데이터 플레인의 이동성 앵커 지점으로, 모든 UE 트래픽은 S-GW를 통과
	- 요금 과금 기능과 법적인 트래픽 차단 기능
- 이동성 관리자(Mobile Management Entity, MME)
	- 관리하는 셀에 위치한 UE의 도움을 받아 연결과 이동성 관리
	- 이를 위해 HHS로부터 UE 등록 정보를 받음
	- 7.7절 자세히
- 홈 등록 서버(Home Subscriber Server, HSS)
	- 로밍 접속용량, QoS 프로파일, 인증 정보 등을 포함한 UE 정보 유지
	- 이런 정보들을 UE 홈 셀룰러 제공자에게서 획득

> 4G 네트워크 구조 및 EPC 관련 문헌
> [Motorola 2007; Palat 2009; Sauter 2014]

#### LTE 무선 액세스 네트워크

LTE는 다운 스트림 채널에 FDM과 TDM을 혼합한 OFDM(Orthogonal Frequency division multiplexing) 방식 사용

> Orthogonal
> 서로 다른 주파수 채널을 이용해 전송되는 신호는 주파수 대역이 아무리 가깝더라도 상호 간 간섭이 거의 없다는 사실에서 비롯

LTE에서 각 이동 노드는 하나 이상의 0.5msec의 시간 슬롯을 하나 이상의 주파수 채널에서 할당받음

같은 주파수 혹은 다른 주파수에서 더 많은 시간 슬롯을 할당받음에 따라 이동 노드는 더 높은 전송률을 가질 수 있음

이동 노드들 간의 슬롯 할당/재할당은 1msec 간격으로 자주 일어남
- 전송률을 변화시키기 위해 서로 다른 변조 방식이 사용될 수 있음

시간 슬롯을 이동 노드에 할당하는 특정한 기법은 LTE 표준에 규정되어 있지 않음
- 어떤 노드가 어느 주파수의 시간 슬롯을 이용해 전송할 지에 대한 문제는 LTE 장비 공급자나 통신망 운영자들이 제공하는 스케줄링 알고리즘에 의해 결정

무선 네트워크 제어부가 전송 매체를 최대한 효율적으로 이용하기 위해, 기회 스케줄링 기법(Opportunistic scheduling)을 사용해 물리 계층의 프로토콜을 송수신 노드 사이의 채널 조건에 맞추고 그 채널 조건에 따라 패킷이 전송될 수신 노드를 결정

또한 사용자 우선순위와 계약된 서비스 레벨이 하향 패킷 전송의 스케줄링에 사용될 수 있음

위에 기술된 LTE 특성에서 더 나아가 LTE-Advanced 기술은 집합적인 채널 할당을 통해 이동 노드에 수백 Mbps의 하향 링크 전송률을 제공

그림
- 4개의 주파수에 8개의 시간 슬롯을 할당받은 상황
![[Screenshot 2023-05-31 at 11.56.01 AM.png]]
- 각 주파수마다 10 msec 프레임 안에 구조화된 20개의 0.5 msec 슬롯

---

이동성 관리: 원칙

이제부터는 무선 링크 덕분에 가능해진 이동성에 대해

> 이동 노드는 네트워크로의 접속점을 수시로 변경하는 노드

이동성의 여러 차원에서의 의미
- 네트워크 계층의 관점에서 사용자가 얼마나 이동하는가?
	- 무선 네트워크 인터페이스가 있는 랩톱을 갖고 건물 내부를 이동하는 사용자 - 네트워크 계층 관점에서는 이동하지 않는 것
	- 사용자가 위치에 상관없이 동일한 접속점에 결합된다면 링크 계층 관점에서도 이동하지 않는 것
![[Screenshot 2023-05-31 at 12.02.43 PM.png]]
- 이동 노드의 주소를 항상 동일하게 유지하는 것이 얼마나 중요한가?
	- 이동 전화를 사용할 때 전화번호(네트워크 레벨의 주소)는 한 회사의 네트워크에서 다른 회사의 네트워크로 이동하더라도 그대로 유지됨
	- 이와 유사하게 랩톱의 IP 주소도 IP 네트워크들을 옮겨다닐 때 동일하게 유지될까?
		- "어떤 애플리케이션을 사용하는 지에 따라 상당히 달라진다"
		- 고속도로를 타고 원격 애플리케이션으로의 TCP 연결을 중단 없이 유지하려고 하는 운전자의 경우, 동일 IP 주소를 유지하는 것이 편할 것
			- 인터넷 애플리케이션이 통신하는 상대방 개체(Entity)의 IP 주소 및 포트 번호를 알아야함
			- 만일 이동 개체가 이동하면서 IP 주소를 그대로 유지할 수 있다면, 그 이동성은 애플리케이션 관점에서는 드러나 보이지 않음
			- 이 같은 투명성이 제공된다면 많은 장점
				- 투명성: 애플리케이션이 변경되는 IP 주소에 대해서 몰라도 되고, 동일 애플리케이션 코드를 사용해서 이동 연결과 비이동 연결을 비슷하게 지원할 수 있는
			- : 이동 IP
		- 동적인 이동성이 적은 경우로, 사무실 랩톱을 집에 가져와 사용하고, 주로 클라이언트/서버 애플리케이션의 클라이언트로 동작하는 경우, 랩톱에서 사용되는 IP 주소는 중요하지 않음
			- ISP가 임시로 할당해주는 주소를 유료로 사용 가능
			- DHCP가 이런 기능 제공(4.3 절)
- 어떤 유선 기반 구조를 사용할 수 있는가?
	- 앞 시나리오들은 이동 사용자가 연결할 수 있는 고정 기반 구조(Ex. 가정 ISP 네트워크, 사무실 무선 액세스 네트워크, 고속도로에 설치된 무선 액세스 네트워크)가 존재한다고 가정
	- 이런 기반 구조가 없으면, 두 사용자가 서로 통신 가능한 거리에 있는 경우 다른 네트워크 계층 기반구조없이 네트워크 연결을 설정할 수 있는 애드 혹 네트워킹
		- [Perkins 2000], IETF MANET(Mobile Ad Hoc Network)

이동 사용자가 네트워크를 이동하면서 기존 연결을 유지할 수 있도록 하는 것
- 집을 떠나 자주 이사하면서 사는 20대
- 오랜 친구가 그에게 연락하고 싶다면 그 사람의 주소를 어떻게 알아냄?
- 부모 집으로 연락하는 것(부모는 자식의 주소를 안다고 가정)
- 따라서 주소가 변하지 않는 고향 집이 그 친구와 통신하기 위해 거쳐야할 첫 장소
- 그 이후에는 간접 혹은 직접 방식으로 통신

> 홈 네트워크: 네트워크 환경에서 이동 노드(랩톱, 스마트폰)의 영구적인 집
> 홈 에이전트: 이동 노드를 위해 이동성 관리 기능을 수행하는 홈 네트워크의 개체
> 방문 네트워크(foreign network or visited network): 이동 노드가 현재 머무는 네트워크
> 방문 에이전트: 이동성 관리 기능을 수행하면서 이동 노드를 도와주는 방문 네트워크의 개체
> 상대방(correspondent): 이동 노드와 통신하려는 개체
> 
> *방문 네트워크는 방문한 곳의 네트워크가 되고, 홈 홈 네트워크는 이동 노드가 원래 속한 네트워크가 됨*
> 
> *에이전트는 라우터, 네트워크의 다른 호스트나 서버에서 실행될 수 있음 - 프로세스로서 실행되는 듯*

---

#### 주소체계

![[Screenshot 2023-05-31 at 12.27.22 PM.png]]
이동 네트워크 구조의 초기 요소

투명성을 지원받기 위해 다른 네트워크로 이동하더라도 자신의 주소를 그대로 유지하게 하는 것이 바람직하다

이동 노드가 방문 홈 네트워크에 있을 때 그 노드의 영구적인 주소(home address)로 전송되는 모든 트래픽은 방문 네트워크로 전달되어야만 함.

이것이 어떻게 가능할까?

한 가지 방법은 방문 네트워크가 다른 모든 네트워크에게 이동 노드가 자신의 네트워크에 머물고 있음을 알려 주는 것
- 이는 도메인 내 또는 도메인 간 라우팅 정보 교환을 이용해 가능
- 이를 위해서는 기존 라우팅 기반구조를 약가 변경 필요
- 방문 네트워크는 이웃들에게 이동 노드의 영구적인 주소로의 경로를 갖고 있음을 알려줌(즉, 이동 노드의 영구적인 주소로 데이터그램을 라우팅할 정확한 경로를 갖고 있음을 다른 네트워크에게 알려줌)
- 그러면 이웃들은 라우팅 경로와 포워딩 테이블을 갱신하는 절차의 일부로서 이 라우팅 정보를 네트워크로 전파
- 이동 노드가 방문 네트워크를 떠나 다른 네트워크로 이동하면, 새 방문 네트워크는 이동 노드로의 새로운 경로를 알려 주고, 이전 방문 네트워크는 이동 노드와 관련된 자신의 라우팅 정보를 제거

이렇게 하면 네트워크 계층 기반구조에 변화를 많이 주지 않으면서 동시에 두 가지 문제 해결
- 다른 네트워크는 이동 노드의 현재 위치를 알 수 있으며
- 포워딩 테이블에 방문 네트워크의 경로 정보가 있으므로 데이터그램을 이동 노드로 쉽게 전달 가능

심각한 문제: 확장성
- 네트워크 라우터가 이동성 관리를 책임져야 한다면, 라우터는 수백만 개의 이동 노드에 대한 엔트리를 포워딩 테이블에 유지하고, 노드가 이동할 때마다 해당 엔트리를 갱신해야

실제로 많이 채택되고 있는 또 다른 방법은 "이동성 기능을 네트워크 중심(core)이 아닌 네트워크 경계(edge)에서 수행하는 것"
- 이동 노드의 홈 네트워크를 이용해서 자연스럽게 제공될 수 있음
- 비유: 부모가 집을 떠난 20대 자식의 위치를 계속 추적하는 것과 마찬가지로 이동 노드의 홈 네트워크에 있는 홈 에이전트는 이동 노드가 머물고 있는 방문 네트워크 추적
- 이동 노드의 위치를 갱신하기 위해 이동 노드 또는 이동 노드를 대표하는 방문 네트워크와 홈 에이전트 간의 적절한 프로토콜 필요

방문 에이전트를 방문 네트워크의 가장자리에 있는 라우터에 위치시키는 것
- 방문 에이전트의 한 가지 역할: 이동 노드를 위한 COA(care-of-address)를 생성
- COA의 네트워크 부분은 방문 네트워크의 주소와 같음
- 따라서 이동 노드는 영구적 주소(permanent address; 고향 집 주소) 및 COA(자식이 머무는 집의 주소; foreign address)와 결합

- 그림에서 이동 노드의 영구적 주소는 128.119.40.186
- 네트워크 79.129.13/14를 방문하면 이동 노드는 COA 79.129.13.2를 갖게 됨
- 방문 에이전트의 두 번째 역할은 홈 에이전트에게 이동 노드가 자신의 (방문 에이전트의) 네트워크에 머물고 있음과 해당 COA를 갖고 있음을 알려주는 것
- 방문 에이전트를 통해 데이터그램을 이동 노드로 재라우팅(reroute)해 줄 때 COA를 사용

이동 노드와 방문 에이전트의 기능을 분리하기는 했지만, 이동 노드도 방문 에이전트의 역할을 할 수 있음
- 예를 들어, 이동 노드는 방문 네트워크에서 COA를 획득한(DHCP 같은 프로토콜을 통해) 후에 홈 에이전트에게 COA를 알려줄 수 있음

 > 정리: 이동 노드가 어떻게 COA를 획득하고 홈 에이전트에게 이 주소를 알려주는지

---

#### 이동 노드로의 라우팅

홈 에이전트가 COA를 아는 것만으로 모든 문제가 해결되지 않음

어떻게 목적지인 이동 노드로 데이터그램을 전달해줄 수 있을까?

홈 에이전트만이 이동 노드의 위치를 알고 다른 네트워크 라우터들을 이를 모르므로, 데이터그램의 목적지 주소를 단순히 이동 노드의 영구적인 주소로 한 후 네트워크 계층 기반구조로 보내는 것은 충분하지 않음
-> 간접 라우팅(indirect routing) 및 직접 라우팅 필요

---

##### 이동 노드로의 간접 라우팅

데이터그램을 이동 노드로 보내고자하는 상대방의 입장에서, 간접 라우팅 방식
- 송신자는 이동 노드가 홈 네트워크에 있는지 혹은 방문 네트워크에 있는지 모르는 상태로 데이터그램의 목적지 주소를 단순히 이동 노드의 영구적 주소로 설정한 후 네트워크로 전송
	- 즉, 송신자는 이동 노드의 이동 상태를 몰라도 됨
- 그러면 데이터그램은 이동 노드의 홈 네트워크로  먼저 전달됨(그림의 1)

홈 에이전트는
- 이동 노드의 COA를 추적하기 위해 방문 에이전트와 정보를 주고받는 것 외에, 홈 에이전트와 같은 홈 네트워크를 가지며 현재 다른 방문 네트워크에 머물고 있는 노드를 목적지로 하는 데이터그램이 오는지 확인하는 일
- 이런 데이터그램이 오면 중간에 가로챈 후, 이동 노드의 COA를 사용해 방문 에이전트로 전달(그림 2)
- 방문 에이전트는 이것을 이동 노드로 전달(그림 3)

이러한 것이 홈 에이전트를 통한 재라우팅(rerouting)
- 홈 에이전트는 이동 노드의 COA를 목적지로 정해 네트워크 계층이 데이터그램을 방문 네트워크로 전달할 수 있게 해줌
- 투명성 제공 측면에서 데이터그램을 수신한 애플리케이션으로 하여금 이 데이터그램이 홈 에이전트를 경유해 전달되었다는 것을 알지 못하게 하는 것이 바람직
- 이 두 목적을 달성하기 위해 홈 에이전트는 상대방에서 온 데이터그램을 변경하지 않고 그대로 유지, 데이터그램을 새로운 더 큰 데이터그램 안에 담아 캡슐화
- 캡슐화된 데이터그램은 이동 노드의 COA를 목적지로 해서 전달
- 이 COA를 소유한 방문 에이전트는 데이터그램을 수신해서 역캡슐화
- 즉, 홈 에이전트에서 캡슐화된 큰 데이터그램으로부터 상대방이 보낸 원 데이터그램을 추출해 이동 노드로 전달(그림 3)
- 

![[Screenshot 2023-05-31 at 12.55.47 PM.png]]

절차
![[Screenshot 2023-05-31 at 1.15.00 PM.png]]

> 여기서 설명한 캡슐화/역캡슐화는 4.3절에서 IP 멀티캐스트와 IPv6에 대한 설명에서 언급된 터널링과 동일


이제 이동 노드가 데이터그램을 상대방에게 어떻게 보내는지 
- 이동 노드는 데이터그램을 상대방을 목적지로 해서(자신의 영구적 주소를  출발지로, 상대방 주소를 목적지 주소로) 직접 보낼 수 있으므로 단순
- 이동 노드는 상대방의 주소를 알기 때문에 데이터그램을 홈 에이전트를 통해 전달하지 않아도 됨(그림 4)

(간접 라우팅에 대한 설명 정리) 이동성 지원에 필요한 새로운 네트워크 계층 기능
- 이동 노드에서 방문 에이전트로의 프로토콜(mobile-node-to-foreign-agent protocol)
	- 이동 노드는 방문 네트워크에 접속할 때 방문 에이전트에 등록 
	- 유사하게, 이동 노드는 방문 네트워크를 떠날 때 방문 에이전트와의 등록 취소
- 방문 에이전트에서 홈 에이전트로의 등록 프로토콜(foreign-agent-to-home-agent registration)
	- 방문 에이전트는 이동 노드의 COA를 홈 에이전트에게 등록
	- 방문 에이전트는 이동 노드가 방문 네트워크를 떠날 때 이동 노드의 COA를 명시적으로 등록 취소하지 않아도 됨; 이동 노드가 다른 네트워크로 이동하여 새로운 COA를 등록할 때 이 문제가 해결될 수 있기 때문
- 홈 에이전트에서의 데이터그램 캡슐화 프로토콜(home-agent datagram encapsulation)
	- 상대방의 원래 데이터그램을 새로운 데이터그램 내에 캡슐화한 후 COA를 목적지로 해 전달
- 방문 에이전트에서의 역캡슐화 프로토콜(foreign-agent decapsulation)
	- 캡슐화된 데이터그램으로부터 상대방의 원래 데이터그램을 추출해서 이동 노드로 전달

> 이동 노드가 네트워크를 이동하며 현재 진행 중인 연결을 유지하는 데 필요한 요소들인 방문 에이전트, 홈 에이전트, 간접 라우팅에 대한 설명

> 이동 IP 표준[RFC 5944]에서는 간접 라우팅 방식을 사용


---

##### 이동 노드로의 직접 라우팅

간접 라우팅 방식에서 발생할 수 있는 비효율성 문제: 삼각 라우팅 문제(triangle routing problem)
- 이동 노드를 목적지로 하는 데이터그램은 상대방과 이동 노드 간에 훨씬 더 효율적인 경로가 존재해도 먼저 홈 에이전트로 전달된 다음에야 방문 네트워크로 전달
- 최악의 경우는 이동 노드가 통신을 하는 상대방의 네트워크를 방문할 때 생김

직접 라우팅은 이를 해결할 수 있으나 추가적인 복잡도 발생

직접 라우팅 방식
- 통신 상대방 네트워크에 있는 상대방 에이전트가 먼저 이동 노드의 COA를 인지
- 간접 라우팅처럼 이동 노드가 최신 COA를 홈 에이전트에게 등록했을 것으로 가정하고, 상대방 에이전트는 홈 에이전트에게 물어봄으로써 이동 노드의 COA를 알 수 있음
- 이동 노드가 방문 에이전트 기능을 수행할 수 있는 것과 같이 상대방도 상대방 에이전트 기능 수행 가능(그림 1, 2)
- 홈 에이전트가 터널링해 주는 것과 유사하게 상대방 에이전트는 데이터그램을 이동 노드의 COA로 직접 터널링(그림 3, 4)

![[Screenshot 2023-05-31 at 1.41.15 PM.png]]

새로운 두 가지 중요한 문제
- 이동 사용자 위치 파악 프로토콜(mobile-user location protocol)이 필요해짐
	- 이는 상대방 에이전트가 홈 에이전트에게 이동 노드의 COA를 문의하기 위해 필요
- 이동 노드가 한 방문 네트워크에서 다른 방문 네트워크로 이동하면 데이터가 어떻게 새로운 방문 네트워크로 전달될 수 있는지
	- 간접 라우팅에선느 홈 에이전트가 관리하는 COA를 갱신함으로써 가능했지만, 직접 라우팅에서는 세션이 시작될 떄 상대방 에이전트가 홈 에이전트에게 COA를 단 한 차례 문의하며, 이후에는 홈 에이전트에서 COA를 갱신하는 것만으로는 데이터를 이동 노드의 새로운 방문 네트워크로 전달해주는 문제를 완벽히 해결 불가

해결하기 위한 방법 한 가지
- 변경된 COA를 통신 상대방에게 알려주는 새로운 프로토콜

또 다른 대안
- GSM 네트워크에서 실제 사용하는 방법
	- 세션 첫 시작 시 이동 노드가 머물고 있던 방문 네트워크로 데이터가 포워딩되고 있다고 가정(1)
	- 이동 노드가 처음 있었던 방문 네트워크의 방문 에이전트는 앵커 방문 에이전트(anchor foreign agent)라 함
	- 이동 노드가 새로운 방문 네트워크로 이동하면(2), 새 방문 에이전트에 등록하고(3), 새 방문 에이전트는 앵커 방문 에이전트에게 이동 노드의 새로운 COA를 알려줌(4)
	- 떠난 이동 노드를 목적지로 하는 캡슐화된 데이터그램을 앵커 방문 에이전트가 수신하면, 앵커 방문 에이전트는 새 COA를 사용해서 데이터그램을 다시 캡슐화한 후 이동 노드로 전달(5)
	- 이후 이동 노드가 또 다른 방문 네트워크로 이동하면, 새 방문 네트워크의 방문 에이전트는 이 방문 네트워크로 전달될 수 있게 하기 위해 앵커 방문 에이전트에게 알려줌

![[Screenshot 2023-05-31 at 1.46.27 PM.png]]


---

### 이동 IP
- 이동성을 지원하는 인터넷 구조 및 프로토콜에 대한 통칭
- IPv4에 대해서는 RFC 5944에 주로 정의됨
- 다양한 동작방식을 지원하는 융통성 있는 표준
	- e.g. 방문 에이전트의 유무에 따른 동작, 에이전트와 이동 노드 간의 다양한 상호발견 방법, 단일 또는 다수의 COA 사용, 다양한 캡슐화 방법 등
- 이동 IP는 복잡한 표준안. 추천 책[Perkins 1998b]
- 여기서는 핵심 개념에 대한 개요 및 이 프로토콜의 가장 빈번한 사용 예

이동 IP 구조에는 홈 에이전트, 방문 에이전트, COA, 캡슐화/역캡슐화 등의 요소 포함
최신 이동 IP 표준에는 이동 노드로의 간접 라우팅 사용에 대해 명시

이동 IP 표준의 구성 요소
- 에이전트 발견(agent discovery)
	- 이동 IP에는 홈 에이전트나 방문 에이전트가 이동 노드에게 자신이 제공할 수 있는 서비스를 알려주기 위해서 사용하는 프로토콜들과 이동 노드가 방문 에이전트나 홈 에이전트에게 서비스를 요청하기 위해 사용하는 프로토콜에 대한 정의가 있음
- 홈 에이전트와의 등록(registration with the home agent)
	- 이동 노드 및 바문 에이전트가 이동 노드의 홈 에이전트와 COA를 등록/해제하기 위해서 사용하는 프로토콜 정의
- 데이터그램의 간접 라우팅(indirect routing of datagram)
	- 데이터그램 포워딩 규칙, 오류 조건 처리 규칙, 다양한 형태의 캡슐화처럼 홈 에이전트가 데이터그램을 이동 노드로 포워딩하는 방법에 대한 정의

이동 IP 표준에서 보안에 대한 고려사항은 매우 중요하게 다뤄짐
- 악의의 사용자가 홈 에이전트에게 가짜 COA를 등록함으로써 데이터그램을 모두 가져가는 것을 막기 위해 이동 노드에 대한 인증이 반드시 필요

---

##### 에이전트 발견
새로운 네트워크로 이동한 이동 IP 노드는 해당 방문 에이전트나 홈 에이전트를 식별 가능해야함

이동 노드의 네트워크 계층은 다른 네트워크 주소를 갖는 새로운 방문 에이전트를 발견함으로써 자신이 다른 방문 네트워크로 이동했음을 파악 가능
- 이 과정을 에이전트 발견이라고 함
- 이는 에이전트 광고나 에이전트 요청의 방법 중 하나를 사용해 수행

에이전트 광고
- 방문 에이전트나 홈 에이전트가 기존의 라우터 발견 프로토콜을 확장해서 자신이 제공하는 서비스를 광고하는 것
- 에이전트는 type 필드가 9인 ICMP 메시지(라우터 발견)를 자신에게 연결된 모든 링크로 주기적으로 브로드캐스트
- 라우터 발견 메시지는 라우터(즉, 에이전트)의 IP 주소를 포함하므로 이동 노드는 에이전트의 IP 주소를 알 수 있게 됨
- 또한 라우터 발견 메시지에는 이동 노드에게 필요한 추가 정보가 포함된 이동 에이전트 광고 확장(extension)이 포함

이 확장의 주요 필드
- Home agent 비트(H)
	- 이 에이전트가 현재 머무는 네트워크의 홈 에이전트임을 의미
- Foreign agent 비트(F)
	- 방문 에이전트임을 의미
- Registration required 비트(R)
	- 이 네트워크에 있는 이동 사용자가 반드시 방문 에이전트에 등록해야 함을 의미
	- 등록하지 않으면 이동 사용자가 방문 네트워크의 COA를 획득(e.g. DHCP를 사용해)할 수도 없고, 이동 노드 자신이 방문 에이전트 기능을 갖고 있을 수도 없음
- M과 G encapsulation 비트
	- IP-in-IP 캡슐화가 아닌 다른 형태의 캡슐화가 사용됨을 의미
- Care-of-address(COA) 필드
	- 방문 에이전트가 제공해 주는 하나 이상의 COA로 구성된 목록
	- 이동 사용자는 홈 에이전트에 등록할 때 이들 COA 중 하나를 선택

에이전트 요청
- 에이전트 광고를 기다리지 않고 에이전트를 찾고자 하는 이동 노드가 에이전트 요청 메시지를 브로드캐스트
- type 필드가 10인 ICMP 메시지
- 이 요청을 수신한 에이전트는 에이전트 광고를 이동 노드에게 직접 유니캐스트
- 이를 수신한 이동 노드는 마치 요청하지 않고 광고를 수신한 것처럼 처리

![[Screenshot 2023-05-31 at 2.11.18 PM.png]]

---

##### 홈 에이전트로의 등록
- 이동 IP 노드가 COA를 수신하면, 이 COA를 홈 에이전트에 등록
- 방문 에이전트를 통하거나(방문 에이전트가 홈 에이전트에 이 COA를 등록) 또는 이동 IP 노드가 직접 함

전자의 경우 다음 네 단계
1. 방문 에이전트 광고를 수신 후, 이동 노드는 이동 IP 등록 메시지를 방문 에이전트로 전달
	1. 등록 메시지는 UDP 데이터그램에 포함되어 포트 434로 전송
	2. 등록 메시지에는 방문 에이전트가 광고한 COA, 홈 에이전트의 주소(HA), 이동 노드의 영구적 주소(MA), 요구된 등록 수명, 64비트의 등록 식별자가 포함
		1. 요구된 등록 수명은 몇 초 동안 유효한 지 의미. 그 시간 동안 홈 에이전트에서 등록이 갱신되지 않으면 등록은 무효
		2. 등록 식별자는 순서 번호와 유사하며, 수신한 등록 응답을 등록 요청과 대응시킬 때 사용
2. 방문 에이전트는 등록 메시지를 수신한 후 이동 노드의 영구적인 IP 주소를 기록
	1. 이제 방문 에이전트는 목적지 주소가 이동 노드의 영구적인 주소인 데이터그램을 포함하고 있는 캡슐화된 데이터그램을 찾아내야 한다는 것을 알게 됨
	2. 방문 에이전트는 이동 IP 등록 메시지를 UDP 데이터그램에 포함시켜서 홈 에이전트의 포트 434로 전송
	3. 이 메시지에는 COA, HA, MA, 요구된 캡슐화 방법, 요구된 등록 수명, 등록 식별 등이 포함
3. 홈 에이전트는 등록 요청을 수신한 후, 이것에 대한 인증 및 정확성 검사
	1. 홈 에이전트는 이동 노드의 영구적인 IP 주소와 COA에 대한 바인딩 정보 갱신
	2. 이후 이동 노드로 가는 데이터그램이 홈 에이전트에 도착하면 홈 에이전트는 데이터그램을 COA로 캡슐화해서 터널링
	3. 홈 에이전트는 HA, MA, 실제 등록 수명, 해당 등록 요청의 등록 식별을 포함하는 이동 IP 등록 응답을 전송
4. 방문 에이전트는 등록 응답을 수신 후 이동 노드로 전달

이제 등록이 완료, 이동 노드는 자신의 영구적인 주소를 목적지로 하는 데이터그램 수신 가능

> 여기서 홈 에이전트는 이동 노드가 요구하는 수명보다 더 짧은 수명을 명시
> 방문 에이전트는 이동 노드가 네트워크를 떠날 때 COA에 대한 등록 해제를 명시적으로 하지 않아도 됨. 등록 해제는 이동 노드가 새로운 네트워크로 이동한 후 새 COA를 등록함으로써 자동으로 처리


![[Screenshot 2023-05-31 at 2.22.53 PM.png]]


> IP 네트워크에서의 이동성

---

### 셀룰러 네트워크에서의 이동성 관리

> IP 네트워크가 아닌 보다 오랫동안 이동성을 지원해온 "휴대전화 셀룰러 네트워크"
> 특히 GSM 셀룰러 네트워크 구조 - 성숙 단계에 있고 널리 사용되고 있음

이동 IP에서와 마찬가지로 GSM 네트워크 구조에서도 기본 원칙이 존재

GSM은 이동 IP와 마찬가지로 간접 라우팅 방식 사용
- 즉, 상대방의 콜을 먼저 이동 노드의 홈 네트워크로 전달한 후 다시 홈 네트워크로부터 방문 네트워크로 전달

- GSM에서는 이동 노드의 홈 네트워크를 이동 노드의 홈 PLMN(Home Public Land Mobile Network)라 함
- 홈 네트워크는 이동 사용자가 가입한 셀룰러 사업자(휴대전화 서비스 요금 명세서를 매달 보내는 사업자)를 말함
- 방문 PLMN(단순히, 방문 네트워크)은 이동 노드가 현재 머물고 있는 네트워크

이동 IP에서처럼 홈 네트워크와 방문 네트워크의 역할에는 큰 차이
1. 
	- 홈 네트워크는 HLR(Home Location Register) 데이터베이스를 유지, HLR에는 가입자마다 영구적인 휴대폰 번호 및 가입자의 개인 정보 포함
	- 중요한 것은, HLR에 가입자의 현재 위치가 저장된다는 것 - 이동 사용자가 다른 사업자의 셀룰러 네트워크에서 로밍 이동 중인 경우 이동 사용자에게 콜이 전달될 수 있도록, HLR에는 이동 노드의 방문 네트워크 내 주소를 알아낼 수 있는 충분한 정보 포함
	- 상대방이 이동 노드로 전화하면, 홈 네트워크의 GMSC(Gateway Mobile Services Switching Center)라는 특수 스위치에 접속 - 편의상 GMSC를 홈 MSC로 부름
2. 
	- 방문 네트워크는 VLR(Visitor Location Register)이라는 데이터베이스를 유지
	- VLR은 자신이 지원하는 네트워크에 현재 있는 이동 사용자마다 엔트리를 가짐
	- 따라서 VLR 엔트리는 이동 사용자가 네트워크에 들어가고 나감에 따라 생성/삭제
	- 보통 VLR은 MSC(Mobile Switching Center)와 함께 존재하고 MSC는 방문 네트워크와의 콜 설정을 조정

실제로 제공자의 셀룰러 네트워크는 그 제공자의 가입자에게는 홈 네트워크 역할을 하고, 다른 셀룰러 제공자의 가입자인 이동 사용자에게는 방문 네트워크 역할

---

#### 이동 사용자로의 콜 전달

> 방문 네트워크에 있는 이동 GSM 사용자에게 어떻게 콜이 전달되는지

1. 상대방이 이동 사용자의 전화번호를 누름(전화번호의 앞자리 숫자 몇 개를 통해 글로벌하게 이동 노드의 홈 네트워크 식별 가능), 요청된 콜은 전화를 건 상대방에서 공중전화 교환망(PSTN)을 거쳐 이동 사용자의 홈 네트워크에 있는 홈 MSC로 전달
2. 콜을 수신한 홈 MSC는 이동 사용자의 위치를 알기 위해 HLR에 문의, HLR은 MSRN(Mobile Station Roaming Number), 즉 로밍 번호(Roaming Number)를 반환. 로밍 번호는 이동 노드의 홈 네트워크와 결합되어 있는 영구적인 전화번호와 다른 것으로, 잠시만 사용되며 이동 노드가 방문 네트워크로 들어갈 때 임시로 할당. 로밍 번호는 이동 IP에서의 COA와 유사하며 COA와 마찬가지로 상대방과 이동 노드는 이 번호의 존재를 모름. HLR이 로밍 번호를 가지고 있지 않으면, 방문 네트워크의 VLR 주소를 반환. 이 경우 홈 MSC는 이동 노드의 로밍 번호를 알기 위해 VLR에 문의해야 함
	1. 처음에 HLR이 로밍 번호 혹은 VLR 주소를 알 수 있는지, 이동 사용자가 또 다른 방문 네트워크로 이동하면 어떤 일이 생기는 지는 추후
3. 로밍 번호를 받으면, 홈 MSC는 네트워크를 거쳐 방문 네트워크의 MSC로 콜을 전달.

전체적으로 보면, 콜을 상대방에서 홈 MSC, 홈 MSC에서 방문 MSC, 방문 MSC에서 이동 사용자를 지원해 주는 기지국으로 전달함으로써 콜 전달이 완료

어떻게 HLR이 이동 사용자의 위치 정보를 얻는가?
- 새로운 VLR에 의해 관장되는 방문 네트워크로 이동 전화 단말기가 들어가면, 그 이동 노드는 방문 네트워크에 등록해야함
- 이는 이동 노드와 VLR 간 시그널링 메시지 교환을 통해 이루어짐
- 그러면 방문 VLR은 위치 갱신 요청 메시지를 이동 노드의 HLR로 보냄, 이 메시지는 HLR에게 이동 노드가 접속한 곳의 이동 번호나 VLR의 주소(나중에 이동 번호를 얻기 위해 VLR에 문의할 수 있음)를 알려줌
- 이러한 메시지 교환 과정 중에 VLR은 HLR로부터 이동 노드의 가입자 정보를 얻고, 이동 사용자가 방문 네트워크로부터 받을 수 있는 서비스를 결정


![[Screenshot 2023-06-01 at 6.31.00 PM.png]]

---

#### GSM에서의 핸드오프

> 핸드오프는 이동 중인 기기가 콜 진행 중에 한 기지국에서 다른 기지국으로 결합 설정을 변경할 때 발생

이동 노드의 콜은 핸드오프 전에는 한 기지국(이전 기지국)을 통해서 이동 노드로 전달되며, 핸드오프 후에는 다른 기지국(새 기지국)을 통해 이동 노드에 전달

핸드오프로 인해 새 기지국으로 데이터를 전송해야할 뿐만 아니라, 진행 중인 콜을 네트워크 내부의 한 교환 지점에서 새 기지국으로 재라우팅해야 함

> 가정: 이전 기지국과 새 기지국이 동일한 MSC를 사용하고, 재라우팅은 이 MSC에서 됨


핸드오프가 발생하는 여러 이유
1. 현재 기지국과 이동 노드 간 신호가 더 이상 콜이 연결되지 않을 정도로 나쁨
2. 콜이 너무 많아 셀에 과부하가 걸림
	- 과부하로 인한 혼잡 상황은 이동 노드를 트래픽이 적은 인글 셀로 핸드오프함으로써 해결 가능

- 한 기지국과 결합된 이동 노드는 주기적으로 현재 기지국으로부터의 비컨 신호뿐만 아니라 들을 수 있는(hear) 인근 기지국으로부터의 비컨 신호의 강도를 측정
- 측정 결과는 초당 한 두 번 이동 노드의 현재 기지국으로 보고
- GSM에서의 핸드오프는 비컨 신호 강도 측정 결과 및 인근 셀의 현재 부하 등을 기반으로 이전 기지국에 의해 시작됨
- GSM 표준에서는 기지국이 핸드오프 여부 결정에 사용하는 알고리즘에 대해 특별히 명시하지 않음

![[Screenshot 2023-06-01 at 6.40.12 PM.png]]


기지국이 이동 사용자를 핸드오프하기로 결정했을 때의 과정
1. 이전 기지국(BS)은 방문 MSC에게 핸드오프가 진행되고 있다는 것과 핸드오프될 기지국(혹은 다수의 기지국들)에 대해서 알려줌
2. 방문 MSC는 재라우팅된 콜을 전달하는 데 필요한 자원을 할당함으로써 새 기지국으로의 경로 설정을 시작하고, 새 기지국에게 핸드오프가 발생할 것임을 알려줌
3. 새 기지국은 이동 노드가 사용할 무선 채널을 할당하고 활성화
4. 새 기지국은 방문 MSC와 이전 기지국에게 방문 MSC에서 새 기지국으로의 경로가 설정되었음을 알려주고, 핸드오프가 진행되고 있음을 이동 노드에게 알려주도록 신호를 보냄. 새 기지국은 이동 노드가 새 기지국과 결합하는데 필요한 모든 정보를 제공
5. 이동 노드는 핸드오프를 수행하도록 통고를 받음. 이때까지 이동 노드는 네트워크가 핸드오프를 하기 위한 준비(새 기지국에서 채널을 할당하고 방문 MSC에서 새 기지국으로의 경로를 할당)를 해온 것에 대해 모름
6. 이동 노드와 새 기지국은 새 기지국의 새 채널을 활성화하기 위해 하나 이상의 메시지를 교환
7. 이동 노드는 새 기지국에게 핸드오프 완료 메시지를 보내고, 이 메시지는 방문 MSC로 전달됨. 방문 MSC는 진행 중인 콜을 새 기지국을 통해서 이동 노드로 재라우팅 해줌
8. 이전 기지국으로의 경로에서 할당된 자원 해제


![[Screenshot 2023-06-01 at 6.49.27 PM.png]]

---

> 이제 이동 노드가 다른 MSC에 결합된 기지국으로 이동하면 어떻게 되는지, 그리고 MSC 간(inter-MSC)에 핸드오프가 한 차례 이상 발생하는 경우 어떻게 되는지

- GSM에서는 앵커 MSC를 정의하고 있음.
- 앵커 MSC는 콜이 처음에 시작될 때 이동 노드가 방문한 MSC(따라서 앵커 MSC는 콜 진행 동안 변경되지 않고 그대로 유지).
- 콜 진행 동안 MSC 간의 핸드오프 횟수와 무관하게 콜은 홈 MSC에서 앵커 MSC로, 다시 앵커 MSC에서 현재 이동 노드가 머무는 방문 MSC로 전달됨
- 이동 노드가 한 MSC의 영역에서 다른 MSC의 영역으로 이동할 때, 진행 중인 콜은 앵커 MSC로부터 새 기지국을 포함하는 새 방문 MSC로 재라우팅됨
- 따라서 상대방과 이동 노드 간에는 항상 최대 3개의 MSC(홈, 앵커, 방문)가 있게 됨

앵커 MSC에서 현재 MSC로 단일 MSC 홉을 유지하는 것외에 다른 방법은 이동 노드가 새 MSC로 이동할 때마다 이전 MSC가 새 MSC로 진행 중인 콜을 전달해 주는 식으로 이동 노드가 방문한 MSC들을 단순히 체인으로 연결하는 것

이러한 MSC 체인 연결은 IS-41 셀룰러 네트워크에서 실제로 발생하고, 선택적으로 앵커 MSC와 현재 방문 MSC 간의 MSC들을 제거함으로써 경로 최소화 가능

![[Screenshot 2023-06-01 at 6.54.24 PM.png]]


> GSM 이동성 관리와 이동 IP의 이동성 관리를 비교 표
> IP와 셀룰러 네트워크는 여러 면에서 기본적인 차이가 있음에도 이동성 관리에서는 다수의 기능 요소 및 전반적 접근 방법이 같음

![[Screenshot 2023-06-01 at 7.00.32 PM.png]]

---

### 무선과 이동성: 상위 계층 프로토콜에의 영향

> 여태까지 링크 계층(페이딩이나 다중경로, 숨은 터미널 등과 같은 무선 채널의 특성)과 네트워크 계층(네트워크 접속점이 동적으로 바뀌는 이동 사용자의 존재)에서 무선 네트워크 간 상당한 차이를 알아보았음

그렇다면 트랜스포트, 애플리케이션 계층에서도 차이가 있을까? 
- 유선/무선 네트워크 모두에서 네트워크 계층은 최선형(best-effort) 전달 서비스를 상위 계층에게 제공해주므로 상위 계층에는 차이가 별로 없을 것으로 생각하기 쉬움
- 마찬가지로, 만일 유선/무선 네트워크에서 애플리케이션에게 트랜스포트 계층 서비스를 제공하기 위해 TCP 혹은 UDP 등의 프로토콜을 사용한다면 애플리케이션은 변경되지 않고 그대로 있어야 함
- 어떤 면에서는 무선 랜이 존재하는 네트워크에서 TCP, UDP가 사용될 수 있다는 생각이 맞을 수도 있음
- 하지만, 특히 TCP 트랜스포트 프로토콜은 유선 네트워크와 무선 네트워크에서 성능 차이가 뚜렷함

TCP는 송신자와 수신자 간 경로에서 손실되거나 오류가 생긴 세그먼트를 재전송함
- 이동 사용자의 경우 네트워크 혼잡 때문에(라우터의 버퍼 오버플로우) 또는 핸드오프 때문에(이동 노드의 새 네트워크 접속점으로 세그먼트를 재라우팅 해주기 위한 지연때문에) 손실을 겪을 수 있음
- 어떤 경우든 TCP의 수신자에서 송신자로 전송되는 ACK는 세그먼트가 성공적으로 수신되었는지 여부만을 알리며, 만일 세그먼트가 손실된 경우에는 그것이 혼잡 때문인지 핸드오프 때문인지 혹은 비트 에러 때문인지 송신자는 알지 못함
- 어떤 이유에서는 송신자의 반응은 항상 같음 - 해당 세그먼트를 재전송
- TCP의 혼잡제어 메커니즘의 반응도 역시 이유와 관계없이 동일 - 이런 경우 TCP는 혼잡 윈도우를 감소시킴
- TCP는 혼잡 윈도우를 무조건 감소시킴으로써 세그먼트 손실이 오류나 핸드오프가 아닌 혼잡에 의해 생겼다고 가정함
- 유선 네트워크보다 무선 네트워크에서 비트 오류가 훨씬 많이 발생함
- 비트 오류나 핸드오프로 인해 손실이 생겼을 경우 TCP 송신자는 혼잡 윈도우를 감소(즉, 송신율 감소)시킬 필요가 없음 - 실제로는 패킷이 혼잡을 겪지 않고 종단 간의 경로를 따라 여유있는 라우터 버퍼를 이용해 제대로 전달되고 있을 수 있음

1990년대 초중반에 연구자들은 무선 랜의 높은 비트율과 핸드오프로 인해 무선 환경에서는 혼잡제어와 관련된 TCP의 무조건적 반응이 문제가 될 수 있음을 알게 됨

문제 해결 세 가지 접근 방법
- 지역 복구(Local Recovery)
	- 비트 오류가 발생했을 때 오류 발생 지점(Ex. 무선 랜)에서 복구해 주는 것
	- 7.3 절에서 802.11 ARQ 프로토콜 혹은 ARQ와 FEC를 모두 사용하는 향상된 방법
- TCP 송신자의 무선 랜 인지(TCP sender awareness of wireless links)
	- 지역 복구 방식에서, TCP 송신자는 세그먼트가 무선 랜을 거쳐서 전달되고 있음을 전혀 알지 못함
	- 대안으로, TCP 송수신자가 무선 랜을 인지하게 해서 유선 네트워크에서의 혼잡으로 인한 손실과 무선 랜에서의 오류나 핸드오프로 인한 손실을 구분하게 하는 방법
	- 즉, 유선 네트워크에서의 혼잡으로 인한 손실에 대해서만 혼잡제어를 하도록 하는 것
- 연결 분리 방법(Split-connection approaches)
	- 무선 사용자의 종단간 연결을 2개의 트랜스포트 계층 연결로 분리
	- 즉, 하나는 무선 사용자와 AP 간, 다른 하나는 AP와 목적지 간에 설정(여기서는 목적지가 유선 호스트라 가정)
	- 따라서 종단간 연결은 무선 부분과 유선 부분으로 분리
	- 무선 구간의 트랜스포트 프로토콜은 표준 TCP 연결이나 UDP 위에서 동작하도록 고안된 복구용 프로토콜일 수 있음
	- 이 방법은 셀룰러 네트워크에서 널리 사용되고 있고, 많은 성능 향상이 있었음

---

애플리케이션 계층 프로토콜에 미치는 영향은?
- 그림 7.2에서 보듯 무선 랜에서의 중요한 고려사항 중 하나는 대역폭이 상대적으로 작다는 것
- 따아서 무선 랜, 특히 셀룰러 네트워크 같은 환경에서 동작하는 응용에게 대역폭은 매우 부족한 자원
- e.g. 3G 셀룰러 폰의 브라우저에게 콘텐츠를 제공하는 웹 서버의 경우, 유선 연결에서의 브라우저에 처럼 이미지가 풍부한 콘텐츠를 제공해줄 수 없는 경우가 많음
- 비록 무선 랜 환경이 애플리케이션 계층 개발에 해결해야할 어려운 문제를 주기는 하지만, 무선랜이 제공하는 이동성 덕분에 여러 종류의 위치 인식 및 환경 인식 애플리케이션이 가능해짐
- 무선 및 이동 네트워크가 애플리케이션 프로토콜에 주는 영향을 생각해본다면 지금까지 언급한 것은 빙산의 일각


![[Screenshot 2023-06-01 at 7.32.38 PM.png]]

---

### 요약

- 무선 특성
	- IEEE 802.11 무선 랜 표준
	- 두 종류의 802.15 WPAN 표준(블루투스, 지그비)
	- 3G, 4G 셀룰러 인터넷 접근에서의 링크 수준 특성
- 이동성
	- 여러 이동성 형태에 대한 문제들과 해결책들
	- 이동 사용자의 위치 파악 및 이동 사용자로의 라우팅 문제
	- 한 네트워크 접속점에서 다른 접속점으로 이동하는 사용자에게 핸드오프를 제공하는 문제
	- 이 문제들이 이동 IP 표준과 GSM에서 어떻게 기술되고 고려되었는지
- 무선 랜과 이동성이 트랜스포트 계층 프로토콜과 애플리케이션에 미치는 영향